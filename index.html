<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Page</title>
    <link rel="stylesheet" href="index.css" />
</head>
<body>

    <a href="recipe.html">
        <img src="image/cip.gif" class="cute_thing" id="cute_thing" alt="Cute character" title="Click for Recipes!" style="cursor: pointer;">
    </a>
    <audio id="koi_audio" src="sounds/Koi.MP3" loop></audio>

    <div class="recipe-container">
        <h1>What would you like to make today?</h1>
        
        <div class="results-grid">
            <!-- Fried Rice -->
            <a href="menu1/menu1.html" class="recipe-card">
                <img src="image/frying_pan_fried_rice.png" alt="Fried Rice">
                <div class="recipe-info">
                    <h3>Fried Rice</h3>
                    <p>Classic favorite!</p>
                </div>
            </a>

            <!-- Placeholder Menu 2 -->
            <a href="menu2/menu2.html" class="recipe-card">
                <img src="image/plate_burger_fries.png" alt="Menu 2">
                <div class="recipe-info">
                    <h3>Menu Option 2</h3>
                    <p>Everyone love it</p>
                </div>
            </a>

            <!-- Placeholder Menu 3 -->
            <a href="menu1/menu1.html" class="recipe-card">
                <img src="image/wave.png" alt="Menu 3">
                <div class="recipe-info">
                    <h3>Menu Option 3</h3>
                    <p>Coming Soon</p>
                </div>
            </a>

            <!-- Placeholder Menu 4 -->
            <a href="menu1/menu1.html" class="recipe-card">
                <img src="image/wave.png" alt="Menu 4">
                <div class="recipe-info">
                    <h3>Menu Option 4</h3>
                    <p>Coming Soon</p>
                </div>
            </a>

            <!-- Placeholder Menu 5 -->
            <a href="menu1/menu1.html" class="recipe-card">
                <img src="image/wave.png" alt="Menu 5">
                <div class="recipe-info">
                    <h3>Menu Option 5</h3>
                    <p>Coming Soon</p>
                </div>
            </a>

            <!-- Placeholder Menu 6 -->
            <a href="menu1/menu1.html" class="recipe-card">
                <img src="image/wave.png" alt="Menu 6">
                <div class="recipe-info">
                    <h3>Menu Option 6</h3>
                    <p>Coming Soon</p>
                </div>
            </a>
        </div>
    </div>

    <div class="movable_window" aria-label="Movable menu">
        <div class="menu_header small">
            <h2>.<span>L</span>ogin</h2>
        </div>  
        <div class="menu_body small">
            <div class="login">
                <input type="text" placeholder="Username" id="username_id" />
                <input type="button" value="Start" id="start_button" />
            </div>
        </div>
    </div>

<script>

    window.addEventListener("click", () => {const click = new Audio("sounds/Click_Sound_Effect.mp3"); click.play(); });
    // Toggle gif and audio on cute_thing click
    const cuteThing = document.getElementById('cute_thing');
    const koiAudio = document.getElementById('koi_audio');
    
    // login + save to backend
    const startBtn = document.getElementById('start_button');
    const usernameInput = document.getElementById('username_id');
    const movableWindow = document.querySelector('.movable_window');

    if (!startBtn || !usernameInput) {
        console.error("Missing start button or username input");
    } else {
        startBtn.addEventListener('click', async () => {

            koiAudio.play().catch(e => console.log("Audio play blocked:", e));

            const username = usernameInput.value.trim();
            const Time = new Date().toLocaleString();
            console.log(`Username: ${username}, Time: ${Time}`);

            // Fade out window immediately
            if (movableWindow) {
                movableWindow.style.transition = "opacity 0.3s ease";
                movableWindow.style.opacity = "0";

                setTimeout(() => {
                    movableWindow.style.display = 'none';
                }, 300);
            }

            // Backend request (non-blocking)
            try {
                const res = await fetch("http://localhost:8000/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ username })
                });

                if (!res.ok) throw new Error(`HTTP ${res.status}`);
                const data = await res.json();
                console.log("Saved:", data);

            } catch (err) {
                console.error("Save failed:", err);
            }
        });
    }

    // make movable window draggable
    if (movableWindow) {
        const menu_header = movableWindow.querySelector('.menu_header.small');
        let offsetX = 0;
        let offsetY = 0;
        let isDragging = false;

        if (menu_header) {
            menu_header.addEventListener('mousedown', (e) => {
                isDragging = true;
                const r = movableWindow.getBoundingClientRect();
                offsetX = e.clientX - r.left;
                offsetY = e.clientY - r.top;
                movableWindow.classList.add('dragging');
            });
        }

        document.addEventListener('mousemove', (e) => {
            if (isDragging) {
                movableWindow.style.left = e.clientX - offsetX + 'px';
                movableWindow.style.top = e.clientY - offsetY + 'px';
                movableWindow.style.transform = 'none';
            }
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            movableWindow.classList.remove('dragging');
        });
    }
    
</script>
</body>
</html>
